---
title: "shark_activity_model"
author: "Koichi Ito"
date: "2018年9月4日"
output: html_document
---

```{r constant_parameters}
source(file = "shark_activity_functions.R")
#=== constant parameters ===
#set time
pi = acos(-1)
tnum = 24 # time of day
t = 1:tnum-0.5

# temperature of the water
t_w=15
wmax = 25
wmax = 30
watertemp = wmin+(wmax-wmin)*(cos(2*pi*(t-t_w)/length(t))+1)/2

# amount of food availability for prey
alpha = rep(1.0, length=tnum)
# baseline mortality for prey (should pay both for resting and foraging)
mb = 0.1	
# average prey swim speed
u0 = 1.0
# metabolic cost for predators when they go out for predation
C = rep(0.1, length=tnum)
```


## No influence of predator's swim speed
When beta = 0.0 and omega>0, prey decide its foraging time only by its foraging efficiency, i.e., u. Then peak of the foraging is always t=tempmaxt=15.

```{r mx_my_analysis_parameters}
#=== plot with changing mx (mortality by other predator) and my (mortality by shark)
omega = 1.0
beta = 1.0
phi = 0.1
h = 0.1

# work out the shark's body temperature
#    mass is kind of the size of shark (like sharkradius)
#    I used this just for simplifying parameters
mass = 10 
sharktemp=calc.bodytemp(watertemp,mass) 
#bodytemp=calc.shark.temp(tnum,watertemp,sharkradius,skinthickness)

# prey immediately track temperature
uk = 0.2 #influence of bodytemp
U = u0 + uk*(watertemp-(wmax+wmin)/2)

# sharks track their own temperature
v0 = 1.4  #average swim speed (prey is always 1.0)
vk = 0.2 #influence of bodytemp
V = v0 + vk*(sharktemp-(wmax+wmin)/2)

# calc light effect, or predation efficiency
#    e.g., in muddy (inclear) water this value will increase?
lmin = 1.0
lmax = 1.0
L = calc.light_effect(t,lmin,lmax)

plot.assumption(t, watertemp, sharktemp, V, U, L)


par(mfrow=c(5,5),mex=0.4)
for(my in rev(seq(0.0,1.5,length=5))){
for(mx in seq(0.0,1.5,length=5)){
	Ans = tss_probforage_energygain_optimize_linear(V, U, alpha, C, L, my, phi, omega, beta, h, mb,mx)
	plot.sim_result(Ans,bquote(list('m'['x']==.(mx),'m'['y']==.(my))))
}
}


par(mfrow=c(1,1))
grid = 51
no = matrix(0,grid,grid)
x.ax = seq(0,2,length=grid)
y.ax = seq(0,2,length=grid)

mx = 1.0
my = 1.0
for(y in 1:length(y.ax)){
	for(x in 1:length(x.ax)){
		mx = x.ax[x]
		my = y.ax[y]
		Ans = tss_probforage_energygain_optimize_linear(V, U, alpha, C, L, my, phi, omega, beta, h, mb,mx)
		no[x,y] = allpeak_no.sim_result(Ans,0.0)
		#	plot.sim_result(Ans,"")
	}
}

mode = allpeak_no.mode(no)
allpeak_no.image(x.ax,y.ax,mode,xlab="mx",ylab="my")
allpeak_no.point(x.ax,y.ax,mode,cex=0.5)

```

First we inveti

```{r mx_my_analysis_parameters2}
#=== plot with changing mx (mortality by other predator) and my (mortality by shark)
omega = 1.0
beta = 1.0
phi = 0.1
h = 0.1

# work out the shark's body temperature
#    mass is kind of the size of shark (like sharkradius)
#    I used this just for simplifying parameters
mass = 10 
sharktemp=calc.bodytemp(watertemp,mass) 
#bodytemp=calc.shark.temp(tnum,watertemp,sharkradius,skinthickness)

# prey immediately track temperature
utemp = 0.2 #influence of bodytemp
U = uave + utemp*(watertemp-(tmax+tmin)/2)

# sharks track their own temperature
vave = 1.4  #average swim speed (prey is always 1.0)
vtemp = 0.2 #influence of bodytemp
V = vave + vtemp*(sharktemp-(tmax+tmin)/2)

# calc light effect, or predation efficiency
#    e.g., in muddy (inclear) water this value will increase?
lmin = 1.0
lmax = 1.0
L = calc.light_effect(t,lmin,lmax)

plot.assumption(t, watertemp, sharktemp, V, U, L)

par(mfrow=c(1,1))
grid = 51
no = matrix(0,grid,grid)
x.ax = seq(0,2,length=grid)
y.ax = seq(0,2,length=grid)

mx = 1.0
my = 1.0
for(y in 1:length(y.ax)){
	for(x in 1:length(x.ax)){
		mx = x.ax[x]
		my = y.ax[y]
		Ans = tss_probforage_energygain_optimize_linear(V, U, alpha, C, L, my, phi, omega, beta, h, mb,mx)
		no[x,y] = allpeak_no.sim_result(Ans,0.0)
		#	plot.sim_result(Ans,"")
	}
}
mode = allpeak_no.mode(no)
allpeak_no.image(x.ax,y.ax,mode,xlab="mx",ylab="my")
allpeak_no.point(x.ax,y.ax,mode,cex=0.5)

par(mfrow=c(5,5),mex=0.4)
for(my in rev(seq(0.0,1.5,length=5))){
for(mx in seq(0.0,1.5,length=5)){
	Ans = tss_probforage_energygain_optimize_linear(V, U, alpha, C, L, my, phi, omega, beta, h, mb,mx)
	plot.sim_result(Ans,bquote(list('m'['x']==.(mx),'m'['y']==.(my))))
}
}
```

```{r mass_phi_analysis_parameters2}
#=== plot with changing mx (mortality by other predator) and my (mortality by shark)
omega = 1.0
beta = 1.0
phi = 0.1
h = 0.1

# work out the shark's body temperature
#    mass is kind of the size of shark (like sharkradius)
#    I used this just for simplifying parameters
mass = 10 
sharktemp=calc.bodytemp(watertemp,mass) 
#bodytemp=calc.shark.temp(tnum,watertemp,sharkradius,skinthickness)

# prey immediately track temperature
utemp = 0.2 #influence of bodytemp
U = uave + utemp*(watertemp-(tmax+tmin)/2)

# sharks track their own temperature
vave = 1.4  #average swim speed (prey is always 1.0)
vtemp = 0.2 #influence of bodytemp
V = vave + vtemp*(sharktemp-(tmax+tmin)/2)

# calc light effect, or predation efficiency
#    e.g., in muddy (inclear) water this value will increase?
lmin = 1.0
lmax = 1.0
L = calc.light_effect(t,lmin,lmax)

mx = 0.5
my = 0.5

plot.assumption(t, watertemp, sharktemp, V, U, L)

x.seq = seq(1,20,length=5)
y.seq = seq(0,0.4,length=5)
par(mfrow=c(1+length(y.seq),length(x.seq)),mex=0.4)
#plot(0,0,type="n",axes=FALSE,xlab="",ylab="")
for(mass in x.seq){
	# work out the shark's body temperature
	sharktemp=calc.bodytemp(watertemp,mass) #just for simplifying parameters
	
	plot(t,watertemp,col="blue",pch=15, xlab="",ylab="")
	lines(t,watertemp,col="blue",lty=1)
	points(t,sharktemp,col="red",pch=16)
	lines(t,sharktemp,col="red",lty=1)
}
for(phi in rev(y.seq)){
	for(mass in x.seq){
		# work out the shark's body temperature
		sharktemp=calc.bodytemp(watertemp,mass) #just for simplifying parameters
		V = vave + vtemp*(sharktemp-(tmax+tmin)/2)
		
		Ans = tss_probforage_energygain_optimize_linear(V, U, alpha, C, L, my, phi, omega, beta, h, mb,mx)
		plot.sim_result(Ans,bquote(list('mass'==.(mass),varphi==.(phi))))
	}
}

par(mfrow=c(1,1))
grid = 51
no = matrix(0,grid,grid)
x.ax = seq(1,20,length=grid)
y.ax = seq(0,0.4,length=grid)
for(y in 1:length(y.ax)){
	for(x in 1:length(x.ax)){
		mass = x.ax[x]
		phi = y.ax[y]
		# work out the shark's body temperature
		sharktemp=calc.bodytemp(watertemp,mass) #just for simplifying parameters
		V = vave + vtemp*(sharktemp-(tmax+tmin)/2)
		
		Ans = tss_probforage_energygain_optimize_linear(V, U, alpha, C, L, my, phi, omega, beta, h, mb,mx)
		no[x,y] = allpeak_no.sim_result(Ans,0.0)
	#	plot.sim_result(Ans,"")
	}
}
mode = allpeak_no.mode(no)
allpeak_no.image(x.ax,y.ax,mode,xlab="mx",ylab="my")
allpeak_no.point(x.ax,y.ax,mode,cex=0.5)
```

[beta = 0.0]
changing omega with mx-my variation
```{r beta_zero_mx_my_omega}
#=== plot with changing mass (sharkradius) and phi ===
omega = 1.0
beta = 1.0
phi = 0.1
h = 0.1

# work out the shark's body temperature
#    mass is kind of the size of shark (like sharkradius)
#    I used this just for simplifying parameters
mass = 10
sharktemp=calc.bodytemp(watertemp,mass) 
#bodytemp=calc.shark.temp(tnum,watertemp,sharkradius,skinthickness)

# prey immediately track temperature
utemp = 0.1 #influence of bodytemp
U = uave + utemp*(watertemp-(tmax+tmin)/2)

# sharks track their own temperature
vave = 1.2 #average swim speed (prey is always 1.0)
vtemp = 0.1 #influence of bodytemp
V = vave + vtemp*(sharktemp-(tmax+tmin)/2)

# calc light effect, or predation efficiency
#    e.g., in muddy (inclear) water this value will increase?
lmin = 1
lmax = 1
L = calc.light_effect(t,lmin,lmax)

#plot.assumption(t,watertemp,sharktemp, V,U,L)



```

changing omega with vave-mass variation
```{r beta_zero_vave_mass_omega}
omega = 0.25
beta = 0.0
phi = 0.0

mx = 0.5
my = 0.5
for(omega in c(0.25,0.5,1.0,2.0)){
	par(mfrow=c(5,4),mex=0.3)
	for(mass in c(1,4,16,64)){
		# work out the shark's body temperature
		sharktemp=calc.bodytemp(watertemp,mass) #just for simplifying parameters
		
		plot(t,watertemp,col="blue",pch=15, xlab="",ylab="")
		lines(t,watertemp,col="blue",lty=1)
		points(t,sharktemp,col="red",pch=16)
		lines(t,sharktemp,col="red",lty=1)
	}
	for(vave in seq(0.4,length=4,by=0.4)){
		for(mass in c(1,4,16,64)){
			# work out the shark's body temperature
			sharktemp=calc.bodytemp(watertemp,mass) #just for simplifying parameters
			V = vave + vtemp*(sharktemp-(tmax+tmin)/2)
			
			Ans = tss_probforage_energygain_optimize_linear(V, U, alpha, C, L, my, phi, omega, beta, h, mb,mx)
			plot.sim_result(Ans,bquote(list('mass'==.(mass),'v'['ave']==.(vave))))
		}
	}
}
```

changing phi with mx-my variation
```{r beta_zero_mx_my_phi}
omega = 1.00
beta = 0.0
phi = 0.0

for(phi in c(0.0,0.05,0.1,0.2,0.4)){
	par(mfrow=c(5,5),mex=0.3)
	for(my in seq(0.0,1.0,length=5)){
		for(mx in seq(0.0,1.0,length=5)){
			Ans = tss_probforage_energygain_optimize_linear(V, U, alpha, C, L, my, phi, omega, beta, h, mb,mx)
			plot.sim_result(Ans,bquote(list('m'['x']==.(mx),'m'['y']==.(my))))
		}
	}
}
```

changing phi with vave-mass variation
```{r beta_zero_vave_mass_phi}
omega = 1.0
beta = 0.0
phi = 0.0

mx = 0.5
my = 0.5
par(mfrow=c(5,4),mex=0.3)
for(phi in c(0.0,0.05,0.1,0.2,0.4)){
	for(mass in c(1,4,16,64)){
		# work out the shark's body temperature
		sharktemp=calc.bodytemp(watertemp,mass) #just for simplifying parameters
		
		plot(t,watertemp,col="blue",pch=15, xlab="",ylab="")
		lines(t,watertemp,col="blue",lty=1)
		points(t,sharktemp,col="red",pch=16)
		lines(t,sharktemp,col="red",lty=1)
	}
	for(vave in seq(0.4,length=4,by=0.4)){
		for(mass in c(1,4,16,64)){
			# work out the shark's body temperature
			sharktemp=calc.bodytemp(watertemp,mass) #just for simplifying parameters
			V = vave + vtemp*(sharktemp-(tmax+tmin)/2)
			
			Ans = tss_probforage_energygain_optimize_linear(V, U, alpha, C, L, my, phi, omega, beta, h, mb,mx)
			plot.sim_result(Ans,bquote(list('mass'==.(mass),'v'['ave']==.(vave))))
		}
	}
}
```

[omega = 0.0]
changing beta with mx-my variation
```{r omega_zero_mx_my_beta}
omega = 0.0
beta = 0.0
phi = 0.0

for(beta in c(0.25,0.5,1.0,2.0)){
	par(mfrow=c(5,5),mex=0.3)
	for(my in seq(0.0,1.0,length=5)){
		for(mx in seq(0.0,1.0,length=5)){
			Ans = tss_probforage_energygain_optimize_linear(V, U, alpha, C, L, my, phi, omega, beta, h, mb,mx)
			plot.sim_result(Ans,bquote(list('m'['x']==.(mx),'m'['y']==.(my))))
		}
	}
}
```

changing beta with vave-mass variation
```{r omega_zero_vave_mass_beta}
omega = 0.0
beta = 0.0
phi = 0.0

for(beta in c(0.25,0.5,1.0,2.0)){
	par(mfrow=c(5,4),mex=0.3)
	for(mass in c(1,4,16,64)){
		# work out the shark's body temperature
		sharktemp=calc.bodytemp(watertemp,mass) #just for simplifying parameters
		
		plot(t,watertemp,col="blue",pch=15, xlab="",ylab="")
		lines(t,watertemp,col="blue",lty=1)
		points(t,sharktemp,col="red",pch=16)
		lines(t,sharktemp,col="red",lty=1)
	}
	for(vave in seq(0.4,length=4,by=0.4)){
		for(mass in c(1,4,16,64)){
			# work out the shark's body temperature
			sharktemp=calc.bodytemp(watertemp,mass) #just for simplifying parameters
			V = vave + vtemp*(sharktemp-(tmax+tmin)/2)
			
			Ans = tss_probforage_energygain_optimize_linear(V, U, alpha, C, L, my, phi, omega, beta, h, mb,mx)
			plot.sim_result(Ans,bquote(list('mass'==.(mass),'v'['ave']==.(vave))))
		}
	}

}
```

changing phi with mx-my variation
```{r omega_zero_mx_my_phi}
omega = 0.0
beta = 1.0
phi = 0.0

for(phi in c(0.0,0.05,0.1,0.2,0.4)){
	par(mfrow=c(5,5),mex=0.3)
	for(my in seq(0.0,1.0,length=5)){
		for(mx in seq(0.0,1.0,length=5)){
			Ans = tss_probforage_energygain_optimize_linear(V, U, alpha, C, L, my, phi, omega, beta, h, mb,mx)
			plot.sim_result(Ans,bquote(list('m'['x']==.(mx),'m'['y']==.(my))))
		}
	}
}
```

changing phi with vave-mass variation
```{r omega_zero_vave_mass_phi}
omega = 0.0
beta = 1.0
phi = 0.0

for(phi in c(0.0,0.05,0.1,0.2,0.4)){
	par(mfrow=c(5,4),mex=0.3)
	for(mass in c(1,4,16,64)){
		# work out the shark's body temperature
		sharktemp=calc.bodytemp(watertemp,mass) #just for simplifying parameters
		
		plot(t,watertemp,col="blue",pch=15, xlab="",ylab="")
		lines(t,watertemp,col="blue",lty=1)
		points(t,sharktemp,col="red",pch=16)
		lines(t,sharktemp,col="red",lty=1)
	}
	for(vave in seq(0.4,length=4,by=0.4)){
		for(mass in c(1,4,16,64)){
			# work out the shark's body temperature
			sharktemp=calc.bodytemp(watertemp,mass) #just for simplifying parameters
			V = vave + vtemp*(sharktemp-(tmax+tmin)/2)
			
			Ans = tss_probforage_energygain_optimize_linear(V, U, alpha, C, L, my, phi, omega, beta, h, mb,mx)
			plot.sim_result(Ans,bquote(list('mass'==.(mass),'v'['ave']==.(vave))))
		}
	}

}
```



[omega = 1.0]
changing beta with mx-my variation
```{r omega_1.0_mx_my_beta}
omega = 1.0
beta = 0.0
phi = 0.0

for(beta in c(0.25,0.5,1.0,2.0)){
	par(mfrow=c(5,5),mex=0.3)
	for(my in seq(0.0,1.0,length=5)){
		for(mx in seq(0.0,1.0,length=5)){
			Ans = tss_probforage_energygain_optimize_linear(V, U, alpha, C, L, my, phi, omega, beta, h, mb,mx)
			plot.sim_result(Ans,bquote(list('m'['x']==.(mx),'m'['y']==.(my))))
		}
	}
}
```

changing beta with vave-mass variation
```{r omega_1.0_vave_mass_beta}
omega = 1.0
beta = 0.0
phi = 0.0

for(beta in c(0.25,0.5,1.0,2.0)){
	par(mfrow=c(5,4),mex=0.3)
	for(mass in c(1,4,16,64)){
		# work out the shark's body temperature
		sharktemp=calc.bodytemp(watertemp,mass) #just for simplifying parameters
		
		plot(t,watertemp,col="blue",pch=15, xlab="",ylab="")
		lines(t,watertemp,col="blue",lty=1)
		points(t,sharktemp,col="red",pch=16)
		lines(t,sharktemp,col="red",lty=1)
	}
	for(vave in seq(0.4,length=4,by=0.4)){
		for(mass in c(1,4,16,64)){
			# work out the shark's body temperature
			sharktemp=calc.bodytemp(watertemp,mass) #just for simplifying parameters
			V = vave + vtemp*(sharktemp-(tmax+tmin)/2)
			
			Ans = tss_probforage_energygain_optimize_linear(V, U, alpha, C, L, my, phi, omega, beta, h, mb,mx)
			plot.sim_result(Ans,bquote(list('mass'==.(mass),'v'['ave']==.(vave))))
		}
	}

}
```

changing phi with mx-my variation
```{r omega_1.0_mx_my_phi}
omega = 1.0
beta = 1.0
phi = 0.0

for(phi in c(0.0,0.05,0.1,0.2,0.4)){
	par(mfrow=c(5,5),mex=0.3)
	for(my in seq(0.0,1.0,length=5)){
		for(mx in seq(0.0,1.0,length=5)){
			Ans = tss_probforage_energygain_optimize_linear(V, U, alpha, C, L, my, phi, omega, beta, h, mb,mx)
			plot.sim_result(Ans,bquote(list('m'['x']==.(mx),'m'['y']==.(my))))
		}
	}
}
```

changing phi with vave-mass variation
```{r omega_1.0_vave_mass_phi}
omega = 1.0
beta = 1.0
phi = 0.0

for(phi in c(0.0,0.05,0.1,0.2,0.4)){
	par(mfrow=c(5,4),mex=0.3)
	for(mass in c(1,4,16,64)){
		# work out the shark's body temperature
		sharktemp=calc.bodytemp(watertemp,mass) #just for simplifying parameters
		
		plot(t,watertemp,col="blue",pch=15, xlab="",ylab="")
		lines(t,watertemp,col="blue",lty=1)
		points(t,sharktemp,col="red",pch=16)
		lines(t,sharktemp,col="red",lty=1)
	}
	for(vave in seq(0.4,length=4,by=0.4)){
		for(mass in c(1,4,16,64)){
			# work out the shark's body temperature
			sharktemp=calc.bodytemp(watertemp,mass) #just for simplifying parameters
			V = vave + vtemp*(sharktemp-(tmax+tmin)/2)
			
			Ans = tss_probforage_energygain_optimize_linear(V, U, alpha, C, L, my, phi, omega, beta, h, mb,mx)
			plot.sim_result(Ans,bquote(list('mass'==.(mass),'v'['ave']==.(vave))))
		}
	}

}
```
##interesting samples
### Perfect fit
```{r perfect_fit}
omega = 0.3
beta = 1.0
phi = 0.0
h = 0.1

# work out the shark's body temperature
mass = 10
sharktemp=calc.bodytemp(watertemp,mass) #just for simplifying parameters
#bodytemp=calc.shark.temp(tnum,watertemp,sharkradius,skinthickness)

# prey immediately track temperature
utemp = 0.1
U = uave + utemp*(watertemp-(tmax+tmin)/2)

# sharks track their own temperature
vave = 1.2
vtemp = 0.1
V = vave + vtemp*(sharktemp-(tmax+tmin)/2)

# calc light effect
lmin = 1.0
lmax = 1.0
L = calc.light_effect(t,lmin,lmax)

par(mfrow=c(5,5),mex=0.3)
for(my in seq(0.0,0.5,length=5)){
	for(mx in seq(0.0,0.5,length=5)){
		Ans = tss_probforage_energygain_optimize_linear(V, U, alpha, C, L, my, phi, omega, beta, h, mb,mx)
		plot.sim_result(Ans,bquote(list('m'['x']==.(mx),'m'['y']==.(my))))
	}
}
```

### Day and night movement

```{r day_and_night}
omega = 2.0
beta = 1.0
phi = 0.1
h = 0.1

# work out the shark's body temperature
mass = 10
sharktemp=calc.bodytemp(watertemp,mass) #just for simplifying parameters
# prey immediately track temperature
utemp = 0.2
vave = 1.8
vtemp = 0.4
U = 1.0 + utemp*(watertemp-(tmax+tmin)/2)
V = vave + vtemp*(sharktemp-(tmax+tmin)/2)

# calc light effect
lmin = 1
lmax = 1
L = calc.light_effect(t,lmin,lmax)

par(mfrow=c(5,5),mex=0.3)
for(my in seq(0.0,2,length=5)){
	for(mx in seq(0.0,2,length=5)){
		Ans = tss_probforage_energygain_optimize_linear(V, U, alpha, C, L, my, phi, omega, beta, h, mb,mx)
		plot.sim_result(Ans,bquote(list('m'['x']==.(mx),'m'['y']==.(my))))
	}
}
```

Day-and-Night pattern appears under high mortality by predation and 


```{r try}
omega = 2.0
beta = 1.0
phi = 0.1
h = 0.1

# work out the shark's body temperature
mass = 10
sharktemp=calc.bodytemp(watertemp,mass) #just for simplifying parameters
# prey immediately track temperature
utemp = 0.2
vave = 1.0
vtemp = 0.4
U = 1.0 + utemp*(watertemp-(tmax+tmin)/2)
V = vave + vtemp*(sharktemp-(tmax+tmin)/2)

# calc light effect
lmin = 1
lmax = 1
L = calc.light_effect(t,lmin,lmax)

par(mfrow=c(5,5),mex=0.3)
for(my in seq(0.0,2,length=5)){
	for(mx in seq(0.0,2,length=5)){
		Ans = tss_probforage_energygain_optimize_linear(V, U, alpha, C, L, my, phi, omega, beta, h, mb,mx)
		plot.sim_result(Ans,bquote(list('m'['x']==.(mx),'m'['y']==.(my))))
	}
}
```